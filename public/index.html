<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Касса - Симулятор 3</title>
    <script src="cdn.jsdelivr.net"></script>
    <style>
        /* Стили CSS не менялись */
    </style>
</head>
<body>
    <div class="card">
        <h1>Касса #3</h1>
        <p>Сумма: <strong id="displayAmount">0.00 руб.</strong></p>
        <p id="transactionStatus">Ожидание транзакции...</p>
        <div id="qrcode"></div>
        <p id="statusText" class="status">✅ ОПЛАЧЕНО УСПЕШНО!</p>
    </div>

    <script>
        let qrCodeInstance = null;

        async function updateCashierScreen() {
            const res = await fetch('/api/server');
            const data = await res.json();
            
            document.getElementById('displayAmount').innerText = data.amount.toFixed(2) + " руб.";

            if (data.paid) {
                document.getElementById('statusText').style.display = "block";
                document.getElementById('qrcode').innerHTML = "";
                document.getElementById('transactionStatus').innerText = "Транзакция завершена";
            } else if (data.id) {
                document.getElementById('statusText').style.display = "none";
                document.getElementById('transactionStatus').innerText = "Ожидание оплаты...";
                generateQR(window.location.origin + "/pay.html");
            } else {
                // Нет активной транзакции
                document.getElementById('statusText').style.display = "none";
                document.getElementById('qrcode').innerHTML = "";
                document.getElementById('transactionStatus').innerText = "Начните новую транзакцию в админке.";
            }
        }

        function generateQR(url) {
            const qrDiv = document.getElementById('qrcode');
            if (!qrCodeInstance) {
                qrCodeInstance = new QRCode(qrDiv, url);
            } else {
                qrCodeInstance.makeCode(url);
            }
        }

        // Обновляем экран кассы каждые 3 секунды
        setInterval(updateCashierScreen, 3000);
        updateCashierScreen(); // Первый запуск при загрузке
    </script>
</body>
</html>
